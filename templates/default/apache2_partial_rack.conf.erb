# apache2 <%= @app %> rack application partial
#
# Generated by Chef for <%= node[:fqdn] %>
# Local modifications will be overwritten.
#

<% if @mount_path.empty? -%>
DocumentRoot        <%= @docroot %>
<% end -%>
<Directory <%= @directory_root %>>
  Options FollowSymlinks -MultiViews
  Allow from all
</Directory>

<% if @mount_path.empty? -%>
RackEnv             <%= @rack_env %>
<% else -%>
<Location <%= @mount_path %>>
  RackBaseURI       <%= @mount_path %>
  RackEnv           <%= @rack_env %>
</Location>
<% end -%>

ErrorDocument 503 <%= @mount_path %>/system/maintenance.html
RewriteEngine On
RewriteCond %{REQUEST_URI} !\.(css|gif|jpg|png)$
RewriteCond %{DOCUMENT_ROOT}<%= @mount_path %>/system/maintenance.html -f
RewriteCond %{SCRIPT_FILENAME} !maintenance.html
RewriteRule ^.*$  -  [redirect=503,last]
